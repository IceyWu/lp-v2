# 实现计划

- [x] 1. 安装必要的依赖和准备 shadcn/ui 组件



  - 检查并安装缺失的 shadcn/ui 组件（toast, sheet）
  - 安装 browser-image-compression 用于图片压缩
  - _需求: 2.3, 2.4, 6.5_



- [ ] 2. 扩展 API 服务
  - [ ] 2.1 在 apiService 中添加更新用户信息的方法
    - 实现 updateUserProfile 方法，支持更新昵称和签名
    - 实现 uploadAvatar 方法，支持上传头像文件
    - 实现 updateUserAvatar 方法，支持更新用户头像引用
    - _需求: 3.1, 3.6, 2.5_
  
  - [ ]* 2.2 为 API 方法编写单元测试
    - 测试 updateUserProfile 方法的请求格式
    - 测试 uploadAvatar 方法的文件上传


    - 测试错误处理逻辑
    - _需求: 6.1, 6.2, 6.3_

- [ ] 3. 创建自定义 React Hook
  - [ ] 3.1 实现 useUpdateProfile hook
    - 使用 useMutation 处理用户信息更新
    - 实现头像上传和信息更新的组合逻辑
    - 处理成功后的缓存刷新（invalidateQueries）
    - 实现错误处理和状态管理
    - _需求: 4.1, 4.2, 4.4, 4.5_
  
  - [x]* 3.2 为 useUpdateProfile hook 编写测试


    - 测试成功场景的缓存更新
    - 测试失败场景的错误处理
    - 测试乐观更新逻辑
    - _需求: 4.1, 4.6_



- [ ] 4. 创建 AvatarUpload 组件
  - [ ] 4.1 实现基础头像上传组件
    - 使用 shadcn/ui Avatar 组件显示当前头像
    - 实现点击触发文件选择功能

    - 添加相机图标覆盖层
    - 实现图片预览功能
    - _需求: 2.1, 2.4_
  
  - [ ] 4.2 添加文件验证逻辑
    - 验证文件类型（jpg, png, webp）
    - 验证文件大小（最大 5MB）
    - 显示验证错误信息
    - _需求: 2.2, 2.3_
  
  - [ ] 4.3 实现图片压缩功能
    - 使用 browser-image-compression 压缩图片


    - 设置目标大小和最大尺寸
    - 保持图片宽高比
    - _需求: 2.5_
  
  - [x]* 4.4 为 AvatarUpload 组件编写测试

    - 测试文件选择功能
    - 测试文件验证逻辑
    - 测试图片预览显示
    - _需求: 2.1, 2.2, 2.3_

- [ ] 5. 创建 ProfileEditDialog 组件
  - [x] 5.1 实现基础对话框结构

    - 使用 shadcn/ui Dialog 组件创建对话框
    - 添加 DialogHeader 和 DialogTitle
    - 添加 DialogFooter 和操作按钮
    - 实现对话框的打开和关闭逻辑
    - _需求: 1.1, 1.3_
  
  - [x] 5.2 实现表单字段

    - 集成 AvatarUpload 组件
    - 使用 shadcn/ui Input 组件创建昵称输入框
    - 使用 shadcn/ui Textarea 组件创建签名输入框
    - 使用 shadcn/ui Label 组件添加表单标签
    - 预填充当前用户信息
    - _需求: 1.2, 3.1, 3.4_

  
  - [ ] 5.3 实现表单验证
    - 添加昵称长度验证（1-20 字符）
    - 添加签名长度验证（最多 100 字符）
    - 实时显示验证错误信息

    - 显示签名剩余字符数
    - 根据验证结果启用/禁用保存按钮
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_
  
  - [ ] 5.4 实现保存功能
    - 调用 useUpdateProfile hook 提交数据
    - 显示加载状态并禁用按钮
    - 处理成功响应并关闭对话框
    - 使用 Toast 显示成功消息
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_
  
  - [ ] 5.5 实现取消功能
    - 检测表单是否有修改


    - 有修改时显示确认对话框
    - 无修改时直接关闭
    - _需求: 5.1, 5.2, 5.3, 5.4_
  
  - [x] 5.6 实现错误处理

    - 捕获并显示 API 错误
    - 使用 Toast 显示错误消息
    - 处理网络错误、认证错误等
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_
  
  - [ ]* 5.7 为 ProfileEditDialog 组件编写测试
    - 测试对话框打开和关闭
    - 测试表单字段预填充
    - 测试表单验证逻辑
    - 测试保存和取消操作
    - _需求: 1.1, 1.2, 1.3, 3.1, 4.1, 5.1_



- [ ] 6. 实现响应式设计
  - [ ] 6.1 创建移动端适配
    - 创建 useMediaQuery hook 检测屏幕尺寸
    - 在移动端使用 shadcn/ui Sheet 组件替代 Dialog
    - 确保移动端布局适配
    - 确保按钮和输入框符合最小点击区域要求
    - _需求: 7.1, 7.2, 7.4_
  
  - [ ] 6.2 优化桌面端显示
    - 设置合适的对话框宽度
    - 确保居中显示


    - 优化间距和布局
    - _需求: 7.3, 7.4_
  
  - [ ]* 6.3 测试响应式布局
    - 测试不同屏幕尺寸下的显示
    - 测试移动端和桌面端的交互
    - _需求: 7.1, 7.2, 7.3, 7.4_

- [ ] 7. 集成到 ProfilePage 组件
  - [ ] 7.1 修改 ProfilePage 组件
    - 导入 ProfileEditDialog 组件
    - 将设置按钮连接到 ProfileEditDialog
    - 确保用户数据正确传递
    - 处理编辑成功后的 UI 更新
    - _需求: 1.1, 4.4_
  
  - [ ]* 7.2 测试集成功能
    - 测试从 ProfilePage 打开编辑对话框
    - 测试编辑后数据更新
    - 测试整体用户流程
    - _需求: 1.1, 4.4, 4.5_

- [ ] 8. 实现可访问性功能
  - [ ] 8.1 添加键盘导航支持
    - 确保 Tab 键可以导航所有交互元素
    - 支持 Enter 键提交表单
    - 支持 Esc 键关闭对话框
    - _需求: 1.3, 4.1, 5.2_
  
  - [x] 8.2 添加屏幕阅读器支持


    - 为所有表单字段添加正确的 label
    - 为错误消息添加 aria-describedby
    - 为对话框添加 aria-labelledby
    - _需求: 1.1, 3.2, 3.3_
  
  - [x] 8.3 实现焦点管理

    - 对话框打开时焦点移至第一个输入框
    - 对话框关闭时焦点返回触发按钮
    - _需求: 1.1, 1.3_
  
  - [ ]* 8.4 测试可访问性
    - 使用键盘测试所有功能
    - 使用屏幕阅读器测试
    - 验证 ARIA 属性正确性
    - _需求: 所有可访问性需求_

- [ ] 9. 性能优化和最终调整
  - [x] 9.1 实现性能优化


    - 为输入验证添加 debounce
    - 实现乐观更新提升响应速度
    - 使用动态导入减少初始包大小
    - _需求: 4.1, 4.4_
  
  - [x] 9.2 代码审查和重构



    - 检查代码质量和一致性
    - 优化组件结构
    - 添加必要的代码注释
    - _需求: 所有需求_
  
  - [ ]* 9.3 端到端测试
    - 测试完整的编辑流程
    - 测试各种错误场景
    - 测试不同设备和浏览器
    - _需求: 所有需求_
